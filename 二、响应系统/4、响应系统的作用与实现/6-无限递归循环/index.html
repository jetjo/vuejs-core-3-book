<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>4.6 避免无限递归循环</title>
    <script type="module">
      // import { effect } from '../5-嵌套的effect与effect栈/1-effect-fn-reg.js'
      // // import { reactive } from '../5-嵌套的effect与effect栈/2-reactive.js'
      // import { reactive } from './2-reactive.js'
      import { effect } from '../8-计算属性与lazy/1-effect-fn-reg.js'
      import { reactive } from '../8-计算属性与lazy/2-reactive.js'
      const obj = {
        i: 0
      }
      const state = reactive(obj)
      window.addEventListener('load', () => {
        effect(() => {
          console.log('effect run')
          // 这一句导致无限递归循环,
          // 原因在于,在一个副作用中对一个响应性对象的字段即读又写
          state.i++
          // 执行不到的代码...
          console.log('fucking~~~~~~~~')
        }, 1)
        // 执行不到的代码...
        console.log('fuck off~~~~~~~~')
      })

      setTimeout(() => {
        state.i++
        console.log('更新状态...')
      }, 5000)
    </script>
  </head>
  <body>
    <a href="../7-调度执行/1-概念.html">7-调度执行</a>
  </body>
</html>
